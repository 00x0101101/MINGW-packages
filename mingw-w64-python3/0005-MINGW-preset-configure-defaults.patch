From a47f740c10ba08313ea086ef5f3bebcae28794c8 Mon Sep 17 00:00:00 2001
From: Roumen Petrov <local@example.net>
Date: Sat, 23 Feb 2013 13:54:37 +0200
Subject: [PATCH 05/16] MINGW: preset configure defaults

---
 Misc/config_mingw  | 12 ++++++++++++
 Misc/cross_mingw32 | 11 +++++++++++
 configure.ac       | 21 +++++++++++++++++++++
 3 files changed, 44 insertions(+)
 create mode 100644 Misc/config_mingw
 create mode 100644 Misc/cross_mingw32

diff --git a/Misc/config_mingw b/Misc/config_mingw
new file mode 100644
index 0000000..513065d
--- /dev/null
+++ b/Misc/config_mingw
@@ -0,0 +1,12 @@
+# configure defaults for mingw* hosts
+
+# mingw functions to ignore
+ac_cv_func_ftruncate=ignore	# implement it as _chsize
+
+# mingw-w64 functions to ignore
+ac_cv_func_truncate=ignore
+ac_cv_func_alarm=ignore
+
+# files to ignore
+ac_cv_file__dev_ptmx=ignore #NOTE: under MSYS environment device exist
+ac_cv_file__dev_ptc=no
diff --git a/Misc/cross_mingw32 b/Misc/cross_mingw32
new file mode 100644
index 0000000..03fde9e
--- /dev/null
+++ b/Misc/cross_mingw32
@@ -0,0 +1,11 @@
+# configure defaults for mingw32 host if cross-build
+
+ac_cv_little_endian_double=yes
+ac_cv_big_endian_double=no
+ac_cv_mixed_endian_double=no
+
+ac_cv_tanh_preserves_zero_sign=yes
+
+ac_cv_wchar_t_signed=no
+
+ac_cv_have_size_t_format=no
diff --git a/configure.ac b/configure.ac
index 6e5de72..21f4884 100644
--- a/configure.ac
+++ b/configure.ac
@@ -791,6 +791,27 @@ esac
 MULTIARCH=$($CC --print-multiarch 2>/dev/null)
 AC_SUBST(MULTIARCH)
 
+# initialize default configuration
+py_config=
+case $host in
+  *-*-mingw*) py_config=mingw ;;
+esac
+if test -n "$py_config" ; then
+  AC_MSG_NOTICE([loading configure defaults from .../Misc/config_$py_config"])
+  . "$srcdir/Misc/config_$py_config"
+fi
+
+# initialize defaults for cross-builds
+if test "$cross_compiling" = yes; then
+  py_config=$host_os
+  case $py_config in
+    mingw32*) py_config=mingw32 ;;
+  esac
+  if test -f "$srcdir/Misc/cross_$py_config" ; then
+    AC_MSG_NOTICE([loading cross defaults from .../Misc/cross_$py_config"])
+    . "$srcdir/Misc/cross_$py_config"
+  fi
+fi
 
 AC_SUBST(LIBRARY)
 AC_MSG_CHECKING(LIBRARY)
-- 
1.7.12.1