# Maintainer: Alexey Pavlov <alexpux@gmail.com>

_realname=pycairo

pkgname="${MINGW_PACKAGE_PREFIX}-python3-cairo"
pkgver=1.10.1.34.5a45b0b
pkgrel=1
pkgdesc="Python 3 bindings for the cairo graphics library (mingw-w64)"
url="http://www.cairographics.org/pycairo"
arch=('any')
license=('LGPL' 'MPL')
depends=("${MINGW_PACKAGE_PREFIX}-python3" "${MINGW_PACKAGE_PREFIX}-cairo")
source=(http://cairographics.org/releases/${_name}-${pkgver}.tar.bz2
    context.patch
    pycairo-1.10.0-waf-python3.4.tar.bz2)
md5sums=('e6fd3f2f1e6a72e0db0868c4985669c5'
         'd4ded5af833f9072954c8bc434f90986'
         '06a60ae51953a2d4e89eb46ac4d282f6')

source=("git://git.cairographics.org/git/pycairo")
md5sums=('SKIP')

pkgver() {
  cd $_realname
  PREFIX="pycairo_version        = '"
  ver=$(grep "$PREFIX" setup.py | sed "s/$PREFIX//" | sed "s/'//")
  revision=$(git rev-list --count HEAD)
  hash=$(git log --pretty=format:'%h' -n 1)
  echo $ver.$revision.$hash
}

build() {
  cd $_realname
  #${MINGW_PREFIX}/bin/python3 setup.py build --optimize=1
  MSYS2_ARG_CONV_EXCL="--prefix=;--install-scripts=;--install-platlib=" \
    ${MINGW_PREFIX}/bin/python3 setup.py build --prefix=${MINGW_PREFIX} --root="$pkgdir" -O1
}

package() {
  cd $_realname
  ${MINGW_PREFIX}/bin/python3 setup.py install --root=$pkgdir/
}
