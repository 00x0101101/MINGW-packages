# Maintainer:  Marty Plummer (The_NetZ) <ntzrmtthihu777 (at) gmail (dot) com>
# Contributor: carstene1ns <url/mail: arch carsten-teibes de>
# Contributor: Jan Alexander Steffens (heftig) <jan.steffens@gmail.com>
# Contributor: Tom Newsom <Jeepster@gmx.co.uk>

_mingw_suff=mingw-w64-${CARCH}
_pkgbase=SDL_sound
_realname=${_pkgbase}-patched-hg
pkgname=${_mingw_suff}-${_realname}
pkgver=r596.719dade41745
pkgrel=1
pkgdesc="A library to decode several popular sound file formats, patched for SDL2 (dev version)"
arch=('any')
url="http://icculus.org/${_pkgbase}/"
license=('LGPL')
depends=("${_mingw_suff}-SDL2"
         "${_mingw_suff}-libmodplug"
	 "${_mingw_suff}-libvorbis"
	 "${_mingw_suff}-flac"
	 "${_mingw_suff}-speex")
conflicts=("${_mingw_suff}-${_pkgbase}")
provides=("${_mingw_suff}-${_pkgbase}")
source=($_pkgbase::"hg+http://hg.icculus.org/icculus/${_pkgbase}"
        'pkgconfig.patch'
        'physfs-renamed-export.patch')
sha256sums=('SKIP'
            'c2ebc5487c678ca4d77f5530a01c14602b9794861f4f75a1097fe47f9a8bd7ff'
            'd7bd96390d9bc877c0204922c7c4666cadfdccc5e6c0cfcf9477d113377f5d10')

pkgver() {
  cd ${_pkgbase}
  printf "r%s.%s" "$(hg identify -n)" "$(hg identify -i)"
}

prepare() {
  echo $(pwd)
  cd ${srcdir}/${_pkgbase}
  echo $(pwd)
  # fix deprecated physfs declaration
  patch -Np1 -i ${srcdir}/physfs-renamed-export.patch
  # patch for SDL2 and pkgconfig support
  patch -Np1 -i ${srcdir}/pkgconfig.patch
  #mv -v ${srcdir}/${_pkgbase}/configure.in ${srcdir}/${_pkgbase}/configure.ac
}

build() {
  cd ${srcdir}/${_pkgbase}
  ./bootstrap
  mkdir -p ${srcdir}/build-${MINGW_CHOST}
  cd ${srcdir}/build-${MINGW_CHOST}
  ${srcdir}/${_pkgbase}/configure \
    --prefix=${MINGW_PREFIX} \
    --build=${MINGW_CHOST} \
    --host=${MINGW_CHOST} \
    --target=${MINGW_CHOST} \
    --disable-static \
    --disable-mikmod \
  make
}

package() {
  cd ${srcdir}/build-${MINGW_CHOST}

  make DESTDIR="$pkgdir/" install
}
