--- cyrus-sasl-2.1.26.orig/lib/saslutil.c	2012-10-12 15:05:48.000000000 +0100
+++ cyrus-sasl-2.1.26/lib/saslutil.c	2014-08-10 13:05:36.996601700 +0100
@@ -607,7 +607,7 @@
     return (0);
 }
 
-#ifdef WIN32
+#if defined(WIN32) && !defined(__MINGW64_VERSION_MAJOR)
 /***************************************************************************** 
  * 
  *  MODULE NAME : GETOPT.C 
--- cyrus-sasl-2.1.26.orig/utils/sasldblistusers.c	2012-01-27 23:31:36.000000000 +0000
+++ cyrus-sasl-2.1.26/utils/sasldblistusers.c	2014-08-12 00:31:13.777208800 +0100
@@ -57,9 +57,13 @@
 
 #ifdef WIN32
 #include <saslutil.h>
+#if defined(__MINGW64_VERSION_MAJOR)
+#include <getopt.h>
+#else
 __declspec(dllimport) char *optarg;
 __declspec(dllimport) int optind;
 #endif
+#endif
 
 /* Cheating to make the utils work out right */
 LIBSASL_VAR const sasl_utils_t *sasl_global_utils;
--- cyrus-sasl-2.1.26.orig/utils/saslpasswd.c	2014-08-12 00:29:33.839492700 +0100
+++ cyrus-sasl-2.1.26/utils/saslpasswd.c	2014-08-12 00:30:07.983445600 +0100
@@ -58,9 +58,12 @@
 #include <io.h>
 
 #include <saslutil.h>
+#if defined(__MINGW64_VERSION_MAJOR)
+#include <getopt.h>
+#else
 __declspec(dllimport) char *optarg;
 __declspec(dllimport) int optind;
-
+#endif
 /* perror can't be used on Windows system calls, so we define a new macro to underline this */
 void p_oserror (const char *string);
 #endif /*WIN32*/
