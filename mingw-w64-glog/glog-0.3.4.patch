diff -c -r glog-0.3.4.orig/configure.ac glog-0.3.4/configure.ac
*** glog-0.3.4.orig/configure.ac	2015-03-11 01:02:27.000000000 -0300
--- glog-0.3.4/configure.ac	2016-03-11 00:44:35.184656900 -0300
***************
*** 24,29 ****
--- 24,38 ----
  AC_PROG_LIBTOOL
  AC_SUBST(LIBTOOL_DEPS)
  
+ ## Toggle build options specific to Windows
+ echo ${host}
+ case "${host}" in
+ 	*-*-mingw*) WIN32="yes" ;;
+ 	*cygwin*) WIN32="yes" ;;
+ 	*) WIN32="no" ;;
+ esac
+ AM_CONDITIONAL([WIN32], test "$WIN32" = "yes")
+ 
  # Check whether some low-level functions/files are available
  AC_HEADER_STDC
  
***************
*** 47,57 ****
  # For backtrace with gcc.
  AC_CHECK_HEADERS(unwind.h)
  
- AC_CHECK_HEADER(windows.h, ac_cv_have_windows_h=1, ac_cv_have_windows_h=0)
- if test x"$ac_cv_have_windows_h" = x"1"; then
-   MINGW_CFLAGS=-Isrc/windows
- fi
- 
  AC_CHECK_SIZEOF(void *)
  
  # These are the types I need.  We look for them in either stdint.h,
--- 56,61 ----
***************
*** 154,181 ****
  # Check if there is Google Test library installed.
  AC_CHECK_PROG(GTEST_CONFIG, gtest-config, "yes")
  AC_CHECK_LIB(gtest, main, have_gtest_lib="yes")
! if test x"$GTEST_CONFIG" = "xyes" -a x"$have_gtest_lib" = "xyes"; then
!   GTEST_CFLAGS=`gtest-config --cppflags --cxxflags`
!   GTEST_LIBS=`gtest-config --ldflags --libs`
    AC_DEFINE(HAVE_LIB_GTEST, 1, [define if you have google gtest library])
! 
    # Check if there is Google Mocking library installed.
    AC_CHECK_PROG(GMOCK_CONFIG, gmock-config, "yes")
!   if test x"$GMOCK_CONFIG" = "xyes"; then
!     GMOCK_CFLAGS=`gmock-config --cppflags --cxxflags`
!     GMOCK_LIBS=`gmock-config --ldflags --libs`
!     AC_DEFINE(HAVE_LIB_GMOCK, 1, [define if you have google gmock library])
!   else
      # We don't run test cases which use Google Mocking framework.
      GMOCK_CFLAGS=
      GMOCK_LIBS=
    fi
- else
-   # We'll use src/googletest.h for our unittests.
-   GTEST_CFLAGS=
-   GTEST_LIBS=
  fi
- AM_CONDITIONAL(HAVE_GMOCK, test x"$GMOCK_CONFIG" = "xyes")
  
  # We want to link in libunwind if it exists
  UNWIND_LIBS=
--- 158,206 ----
  # Check if there is Google Test library installed.
  AC_CHECK_PROG(GTEST_CONFIG, gtest-config, "yes")
  AC_CHECK_LIB(gtest, main, have_gtest_lib="yes")
! AC_CHECK_HEADERS(gtest/gtest.h, ac_cv_have_gtest_h=1, ac_cv_have_gtest_h=0)
! if test x"$have_gtest_lib" != "xyes"; then
!   # We'll use src/googletest.h for our unittests.
!   GTEST_CFLAGS=
!   GTEST_LIBS=
! elif test x"$GTEST_CONFIG" != "xyes" -a x"$ac_cv_have_gtest_h" != x"1"; then
!   # We'll use src/googletest.h for our unittests.
!   GTEST_CFLAGS=
!   GTEST_LIBS=
! else
    AC_DEFINE(HAVE_LIB_GTEST, 1, [define if you have google gtest library])
!   if test x"$GTEST_CONFIG" = "xyes"; then
!     GTEST_CFLAGS=`gtest-config --cppflags --cxxflags`
!     GTEST_LIBS=`gtest-config --ldflags --libs`
!   elif test x"$GTEST_LIBS" = x""; then
!     GTEST_LIBS="-lgtest"
!   fi
!   
    # Check if there is Google Mocking library installed.
    AC_CHECK_PROG(GMOCK_CONFIG, gmock-config, "yes")
!   AC_CHECK_LIB(gmock, main, have_gmock_lib="yes")
!   AC_CHECK_HEADERS(gmock/gmock.h, ac_cv_have_gmock_h=1, ac_cv_have_gmock_h=0)
!   if test x"$have_gmock_lib" != "xyes"; then
!     # We don't run test cases which use Google Mocking framework.
!     GMOCK_CFLAGS=
!     GMOCK_LIBS=
!     AM_CONDITIONAL(HAVE_GMOCK, false)
!   elif test x"$GMOCK_CONFIG" != "xyes" -a x"$ac_cv_have_gmock_h" != x"1"; then
      # We don't run test cases which use Google Mocking framework.
      GMOCK_CFLAGS=
      GMOCK_LIBS=
+     AM_CONDITIONAL(HAVE_GMOCK, false)
+   else
+     AC_DEFINE(HAVE_LIB_GMOCK, 1, [define if you have google gmock library])
+     if test x"$GMOCK_CONFIG" = "xyes"; then
+       GMOCK_CFLAGS=`gmock-config --cppflags --cxxflags`
+       GMOCK_LIBS=`gmock-config --ldflags --libs`
+     elif test x"$GMOCK_LIBS" = x""; then
+       GMOCK_LIBS="-lgmock"
+     fi
+     AM_CONDITIONAL(HAVE_GMOCK, true)
    fi
  fi
  
  # We want to link in libunwind if it exists
  UNWIND_LIBS=
***************
*** 226,232 ****
  AC_SUBST(GFLAGS_CFLAGS)
  AC_SUBST(GTEST_CFLAGS)
  AC_SUBST(GMOCK_CFLAGS)
- AC_SUBST(MINGW_CFLAGS)
  AC_SUBST(GFLAGS_LIBS)
  AC_SUBST(GTEST_LIBS)
  AC_SUBST(GMOCK_LIBS)
--- 251,256 ----
diff -c -r glog-0.3.4.orig/Makefile.am glog-0.3.4/Makefile.am
*** glog-0.3.4.orig/Makefile.am	2015-03-11 01:02:27.000000000 -0300
--- glog-0.3.4/Makefile.am	2016-03-11 01:02:01.046270300 -0300
***************
*** 16,21 ****
--- 16,23 ----
    AM_CXXFLAGS += -Wall -Wwrite-strings -Woverloaded-virtual -Wno-sign-compare
  endif
  
+ MINGW_CFLAGS =
+ 
  # These are x86-specific, having to do with frame-pointers
  if X86_64
  if ENABLE_FRAME_POINTERS
***************
*** 201,206 ****
--- 203,211 ----
  libglog_la_CXXFLAGS = $(PTRHEAD_CFLAGS) $(GFLAGS_CFLAGS) $(MINGW_CFLAGS) \
                        $(AM_CXXFLAGS) -DNDEBUG
  libglog_la_LDFLAGS = $(PTRHEAD_CFLAGS) $(GFLAGS_LDFLAGS)
+ if WIN32
+   libglog_la_LDFLAGS += -no-undefined
+ endif
  libglog_la_LIBADD = $(COMMON_LIBS)
  
  ## The location of the windows project file for each binary we make
diff -c -r glog-0.3.4.orig/src/glog/vlog_is_on.h.in glog-0.3.4/src/glog/vlog_is_on.h.in
*** glog-0.3.4.orig/src/glog/vlog_is_on.h.in	2015-03-11 01:02:27.000000000 -0300
--- glog-0.3.4/src/glog/vlog_is_on.h.in	2016-03-11 01:50:24.723791900 -0300
***************
*** 110,116 ****
  // initialized.  We make this a large value, so the common-case check
  // of "*vlocal__ >= verbose_level__" in VLOG_IS_ON definition
  // passes in such cases and InitVLOG3__ is then triggered.
! extern @ac_google_namespace@::int32 kLogSiteUninitialized;
  
  // Helper routine which determines the logging info for a particalur VLOG site.
  //   site_flag     is the address of the site-local pointer to the controlling
--- 110,116 ----
  // initialized.  We make this a large value, so the common-case check
  // of "*vlocal__ >= verbose_level__" in VLOG_IS_ON definition
  // passes in such cases and InitVLOG3__ is then triggered.
! extern GOOGLE_GLOG_DLL_DECL @ac_google_namespace@::int32 kLogSiteUninitialized;
  
  // Helper routine which determines the logging info for a particalur VLOG site.
  //   site_flag     is the address of the site-local pointer to the controlling
diff -c -r glog-0.3.4.orig/src/logging_unittest.cc glog-0.3.4/src/logging_unittest.cc
*** glog-0.3.4.orig/src/logging_unittest.cc	2015-03-11 01:02:27.000000000 -0300
--- glog-0.3.4/src/logging_unittest.cc	2016-03-11 01:49:17.055080300 -0300
***************
*** 627,633 ****
      LOG(FATAL) << "No directory separator.";
    }
    const string dirname = pattern.substr(0, index + 1);
!   if (FAILED(handle)) {
      // Finding no files is OK.
      return;
    }
--- 627,633 ----
      LOG(FATAL) << "No directory separator.";
    }
    const string dirname = pattern.substr(0, index + 1);
!   if (handle == INVALID_HANDLE_VALUE) {
      // Finding no files is OK.
      return;
    }
diff -c -r glog-0.3.4.orig/src/utilities.h glog-0.3.4/src/utilities.h
*** glog-0.3.4.orig/src/utilities.h	2015-03-11 01:02:27.000000000 -0300
--- glog-0.3.4/src/utilities.h	2016-03-11 01:49:38.932094400 -0300
***************
*** 75,81 ****
  #include <string>
  
  #if defined(OS_WINDOWS)
! # include "port.h"
  #endif
  
  #include "config.h"
--- 75,81 ----
  #include <string>
  
  #if defined(OS_WINDOWS)
! # include "windows/port.h"
  #endif
  
  #include "config.h"
diff -c -r glog-0.3.4.orig/src/windows/port.h glog-0.3.4/src/windows/port.h
*** glog-0.3.4.orig/src/windows/port.h	2015-03-11 01:02:27.000000000 -0300
--- glog-0.3.4/src/windows/port.h	2016-03-11 01:50:04.455878800 -0300
***************
*** 132,137 ****
--- 132,138 ----
  #endif  // _MSC_VER
  
  // ----------------------------------- THREADS
+ #ifndef __MINGW32__
  typedef DWORD pthread_t;
  typedef DWORD pthread_key_t;
  typedef LONG pthread_once_t;
***************
*** 143,148 ****
--- 144,150 ----
    localtime_s(result, timep);
    return result;
  }
+ #endif  // __MINGW32__
  
  inline char* strerror_r(int errnum, char* buf, size_t buflen) {
    strerror_s(buf, buflen, errnum);
