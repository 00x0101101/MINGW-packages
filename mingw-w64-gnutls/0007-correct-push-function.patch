From a83ff2c7ca091af646dd787f426694d889eed46a Mon Sep 17 00:00:00 2001
From: Nikos Mavrogiannopoulos <nmav@gnutls.org>
Date: Fri, 24 Jan 2014 19:44:58 +0100
Subject: [PATCH] corrected push/pull function setting

---
 src/common.h |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/src/common.h b/src/common.h
index f5d66ff..927c175 100644
--- a/src/common.h
+++ b/src/common.h
@@ -68,7 +68,8 @@ pin_callback(void *user, int attempt, const char *token_url,
 void pkcs11_common(void);
 
 #ifdef _WIN32
-static int neterrno()
+# include <errno.h>
+static int neterrno(void)
 {
 int err = WSAGetLastError();
   
@@ -93,11 +94,12 @@ system_read(gnutls_transport_ptr_t ptr, void *data, size_t data_size)
 	return recv((long)ptr, data, data_size, 0);
 }
 
+static
 void set_read_funcs(gnutls_session_t session)
 {
-	gnutls_transport_set_push_function(vpninfo->https_sess, system_write);
-	gnutls_transport_set_pull_function(vpninfo->https_sess, system_read);
-	gnutls_transport_set_errno_function(vpninfo->https_sess, neterrno);
+	gnutls_transport_set_push_function(session, system_write);
+	gnutls_transport_set_pull_function(session, system_read);
+	gnutls_transport_set_errno_function(session, neterrno);
 
 }
 #else
-- 
1.7.1
